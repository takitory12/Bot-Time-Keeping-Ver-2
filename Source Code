const { Client, Intents, GatewayIntentBits } = require('discord.js');
const client = new Client({
  intents: [
    Intents.FLAGS.GUILDS,
    Intents.FLAGS.GUILD_MESSAGES,
    GatewayIntentBits.MessageContent,
    GatewayIntentBits.MessageReactions,
  ],
});

const { REST } = require('@discordjs/rest');
const { Routes } = require('discord-api-types/v9');
const { SlashCommandBuilder } = require('@discordjs/builders');

const commands = [
  new SlashCommandBuilder()
    .setName('diemdanh')
    .setDescription('Cháº¥m cÃ´ng vÃ  ghi nhá»› emoji')
    .addStringOption(option =>
      option.setName('emoji')
        .setDescription('Emoji cho cháº¥m cÃ´ng')
        .setRequired(false)
    ),
  new SlashCommandBuilder()
    .setName('checkdiemdanh')
    .setDescription('Hiá»‡n sá»‘ láº§n Ä‘Ã£ cháº¥m cÃ´ng'),
  new SlashCommandBuilder()
    .setName('setchannel')
    .setDescription('CÃ i Ä‘áº·t kÃªnh hoáº¡t Ä‘á»™ng cho bot')
    .addChannelOption(option =>
      option.setName('channel')
        .setDescription('KÃªnh cáº§n cÃ i Ä‘áº·t')
        .setRequired(true)
    ),
  new SlashCommandBuilder()
    .setName('emo')
    .setDescription('Äá»•i emoji cho cháº¥m cÃ´ng')
    .addStringOption(option =>
      option.setName('emoji')
        .setDescription('Emoji má»›i cho cháº¥m cÃ´ng')
        .setRequired(true)
    ),
].map(command => command.toJSON());

const rest = new REST({ version: '9' }).setToken('YOUR_BOT_TOKEN');

(async () => {
  try {
    console.log('Started refreshing application (/) commands.');

    await rest.put(
      Routes.applicationGuildCommands('YOUR_CLIENT_ID', 'YOUR_GUILD_ID'),
      { body: commands },
    );

    console.log('Successfully reloaded application (/) commands.');
  } catch (error) {
    console.error(error);
  }
})();

const diemdanhData = {};
let activeChannel = null;
const defaultEmoji = 'ðŸ“Œ';

client.once('ready', () => {
  console.log(`Logged in as ${client.user.tag}`);
});

client.on('interactionCreate', async interaction => {
  if (!interaction.isCommand()) return;

  const { commandName } = interaction;

  if (commandName === 'diemdanh') {
    const emoji = interaction.options.getString('emoji') || defaultEmoji;
    try {
      await interaction.react(emoji);
      diemdanhData[interaction.user.id] = emoji;
      await interaction.reply({ content: 'Cháº¥m cÃ´ng thÃ nh cÃ´ng!', ephemeral: true });
    } catch (error) {
      console.error('KhÃ´ng thá»ƒ react emoji:', error);
      await interaction.reply({ content: 'CÃ³ lá»—i xáº£y ra!', ephemeral: true });
    }
  } else if (commandName === 'checkdiemdanh') {
    const count = Object.values(diemdanhData).filter(e => e === diemdanhData[interaction.user.id]).length;
    await interaction.reply(`Báº¡n Ä‘Ã£ cháº¥m cÃ´ng ${count} láº§n.`);
  } else if (commandName === 'setchannel') {
    const channel = interaction.options.getChannel('channel');
    activeChannel = channel;
    await interaction.reply(`Bot sáº½ hoáº¡t Ä‘á»™ng trong kÃªnh ${channel}.`);
  } else if (commandName === 'emo') {
    const emoji = interaction.options.getString('emoji');
    diemdanhData[interaction.user.id] = emoji;
    await interaction.reply(`Emoji cháº¥m cÃ´ng cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»•i thÃ nh ${emoji}.`);
  }
});

// Thay Ä‘á»•i 'YOUR_BOT_TOKEN' vÃ  'YOUR_CLIENT_ID' thÃ nh token cá»§a bot Discord vÃ  ID cá»§a client cá»§a báº¡n Ä‘á»ƒ cháº¡y mÃ£
client.login('YOUR_BOT_TOKEN');
